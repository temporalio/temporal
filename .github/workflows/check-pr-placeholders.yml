name: PR Placeholder Check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  placeholder-check:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read

    steps:
      - name: Get PR description
        id: get-pr-body
        uses: actions/github-script@v7
        with:
          result-encoding: string
          script: |
            const pr = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number
            });
            return pr.data.body || '';

      - name: Check for placeholder lines
        id: check
        run: |
          echo "Writing PR body to file..."
          printf "%s\n" "$BODY" > body.txt

          echo "Checking for placeholder lines (starting and ending with underscore)..."
          grep -En '^_.*_$' body.txt || true
          count=$(grep -cEn '^_.*_$' body.txt || true)

          if [ "$count" -gt 0 ]; then
            echo "Found $count placeholder line(s)."
            echo "warning_detected=true" >> $GITHUB_OUTPUT
            exit 1
          else
            echo "No placeholder lines found."
            echo "warning_detected=false" >> $GITHUB_OUTPUT
          fi
        env:
          BODY: ${{ steps.get-pr-body.outputs.result }}

      - name: Mark job passed (if only warning)
        if: failure() && steps.check.outputs.warning_detected == 'true'
        run: echo "Warning noted, but not failing the check."
