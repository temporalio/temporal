name: Block PRs with Placeholder Lines

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  pull-requests: read

jobs:
  enforce-clean-description:
    runs-on: ubuntu-latest

    steps:
      - name: Validate PR description for placeholders
        uses: actions/github-script@v7
        with:
          script: |
            const pr = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number
            });

            const body = pr.data.body || '';
            const lines = body.split(/\r?\n/);

            const placeholderLines = lines
              .map((line, index) => ({ line, number: index + 1 }))
              .filter(({ line }) => /^_.*_$/.test(line.trim()));

            if (placeholderLines.length > 0) {
              console.log(`❌ Found ${placeholderLines.length} placeholder line(s):`);
              placeholderLines.forEach(({ number, line }) => {
                console.log(`Line ${number}: ${line}`);
              });

              core.setFailed(`PR contains ${placeholderLines.length} placeholder line(s) that must be removed.`);
            } else {
              console.log("✅ PR description is clean.");
            }
